import { timerElement } from "../timerElement.js";

export function initPlayButton(playButton) {
	let isPlaying = false;
	let isRunning = false;

	let timerInterval = null;
	let startTime = 0;
	let elapsedTime = 0;

	playButton.addEventListener("click", () => {
		if (isPlaying) {
			playButton.innerHTML = `
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 6C26.8577 6 21.8309 7.52487 17.5552 10.3818C13.2795 13.2387 9.94702 17.2994 7.97914 22.0502C6.01127 26.8011 5.49638 32.0288 6.49959 37.0723C7.50281 42.1159 9.97907 46.7486 13.6152 50.3848C17.2514 54.0209 21.8842 56.4972 26.9277 57.5004C31.9712 58.5036 37.1989 57.9887 41.9498 56.0209C46.7007 54.053 50.7613 50.7205 53.6182 46.4448C56.4751 42.1691 58 37.1423 58 32C57.9927 25.1066 55.2511 18.4976 50.3767 13.6233C45.5024 8.74889 38.8934 6.00728 32 6ZM32 54C27.6488 54 23.3953 52.7097 19.7775 50.2923C16.1596 47.8749 13.3398 44.439 11.6747 40.419C10.0095 36.3991 9.57386 31.9756 10.4227 27.708C11.2716 23.4404 13.3669 19.5204 16.4437 16.4437C19.5204 13.3669 23.4404 11.2716 27.708 10.4227C31.9756 9.57385 36.3991 10.0095 40.419 11.6747C44.439 13.3398 47.875 16.1596 50.2923 19.7775C52.7097 23.3953 54 27.6488 54 32C53.9934 37.8327 51.6734 43.4247 47.5491 47.549C43.4247 51.6734 37.8327 53.9934 32 54ZM41.11 30.335L29.11 22.335C28.8087 22.134 28.4585 22.0186 28.0968 22.001C27.735 21.9835 27.3753 22.0645 27.056 22.2355C26.7367 22.4064 26.4699 22.6609 26.2839 22.9716C26.0979 23.2824 25.9998 23.6378 26 24V40C25.9998 40.3622 26.0979 40.7176 26.2839 41.0284C26.4699 41.3391 26.7367 41.5936 27.056 41.7645C27.3753 41.9355 27.735 42.0165 28.0968 41.999C28.4585 41.9814 28.8087 41.866 29.11 41.665L41.11 33.665C41.3843 33.4824 41.6093 33.2349 41.7649 32.9444C41.9205 32.654 42.002 32.3295 42.002 32C42.002 31.6705 41.9205 31.346 41.7649 31.0556C41.6093 30.7651 41.3843 30.5176 41.11 30.335ZM30 36.2625V27.75L36.395 32L30 36.2625Z" fill="#F8F8FC"/>
      </svg>
    `;
		} else {
			playButton.innerHTML = `
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 6C26.8577 6 21.8309 7.52487 17.5552 10.3818C13.2795 13.2387 9.94702 17.2994 7.97914 22.0502C6.01127 26.8011 5.49638 32.0288 6.49959 37.0723C7.50281 42.1159 9.97907 46.7486 13.6152 50.3848C17.2514 54.0209 21.8842 56.4972 26.9277 57.5004C31.9712 58.5036 37.1989 57.9887 41.9498 56.0209C46.7007 54.053 50.7613 50.7205 53.6182 46.4448C56.4751 42.1691 58 37.1423 58 32C57.9927 25.1066 55.2511 18.4976 50.3767 13.6233C45.5024 8.74889 38.8934 6.00728 32 6ZM32 54C27.6488 54 23.3953 52.7097 19.7775 50.2923C16.1596 47.8749 13.3398 44.439 11.6747 40.419C10.0095 36.3991 9.57386 31.9756 10.4227 27.708C11.2716 23.4404 13.3669 19.5204 16.4437 16.4437C19.5204 13.3669 23.4404 11.2716 27.708 10.4227C31.9756 9.57385 36.3991 10.0095 40.419 11.6747C44.439 13.3398 47.875 16.1596 50.2923 19.7775C52.7097 23.3953 54 27.6488 54 32C53.9934 37.8327 51.6734 43.4247 47.5491 47.549C43.4247 51.6734 37.8327 53.9934 32 54ZM28 24V40C28 40.5304 27.7893 41.0391 27.4142 41.4142C27.0392 41.7893 26.5304 42 26 42C25.4696 42 24.9609 41.7893 24.5858 41.4142C24.2107 41.0391 24 40.5304 24 40V24C24 23.4696 24.2107 22.9609 24.5858 22.5858C24.9609 22.2107 25.4696 22 26 22C26.5304 22 27.0392 22.2107 27.4142 22.5858C27.7893 22.9609 28 23.4696 28 24ZM40 24V40C40 40.5304 39.7893 41.0391 39.4142 41.4142C39.0392 41.7893 38.5304 42 38 42C37.4696 42 36.9609 41.7893 36.5858 41.4142C36.2107 41.0391 36 40.5304 36 40V24C36 23.4696 36.2107 22.9609 36.5858 22.5858C36.9609 22.2107 37.4696 22 38 22C38.5304 22 39.0392 22.2107 39.4142 22.5858C39.7893 22.9609 40 23.4696 40 24Z" fill="#F8F8FC"/>
      </svg>
    `;
		}

		isPlaying = !isPlaying;

		if (!isRunning) {
			startTime = Date.now() - elapsedTime * 1000;
			timerInterval = setInterval(() => {
				const elapsed = Math.floor((Date.now() - startTime) / 1000);
				const minutes = Math.floor(elapsed / 60);
				const seconds = elapsed % 60;
				timerElement.textContent = `${minutes
					.toString()
					.padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
			}, 1000);
			isRunning = true;
		} else {
			elapsedTime = Math.floor((Date.now() - startTime) / 1000);
			clearInterval(timerInterval);
			timerInterval = null;
			isRunning = false;
		}
	});
}
